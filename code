# ORG 0000H
	   JMP MAIN1
# ORG 003CH
	   JMP ISR

MAIN1:	   DI
	   LXI H,9010
	   MVI A,00
	   STA 9006; XOR FLAG
	   MVI A,00
	   STA 900A; SHIP COUNT
	   MVI A,00
	   STA 9008; SHOT COUNT
	   MVI A,00
	   STA 9009; HIT COUNT
	   MVI A,7E
	   OUT 04
	   OUT 05
	   MVI A,00
	   MVI B,08
	   MVI C,80

LOOP1:	   MVI A,00
	   MOV M,A
	   INX H
	   DCR B
	   JNZ LOOP1
	LXI H,9020
	MVI B,08
LOOP2:	MVI A,00
	MOV M,A
	INX H
	DCR B
	JNZ LOOP2
7SEG:	LXI H,B010
	MVI M,7E
	INX H
	MVI M,0C
	INX H
	MVI M,B6
	INX H
	MVI M,9E
	INX H
	MVI M,CC
	INX H
	MVI M,DA
	INX H
	MVI M,FA
	INX H
	MVI M,0E
	INX H
	MVI M,FE
	INX H
	MVI M,DE
	INX H
   	   LXI SP,FFFE
	   LXI H,9010
	   MVI D,89
	   MVI E,01
	MVI A,10
	STA 9002
	MVI A,90
	STA 9003
	   MVI A,0B
	   SIM
	   EI

MAIN:	   IN 03
                           CPI BF
	CZ DBUNCE
	IN 03
	CPI BF
	CZ UP
	IN 03
                           CPI EF
	CZ DBUNCE
	IN 03
	CPI EF
	CZ DOWN
	    IN 03
                           CPI F7
	CZ DBUNCE
	IN 03
	CPI F7
	    CZ RIGHT
	IN 03
                           CPI DF
	CZ DBUNCE
	CPI DF
	CZ LEFT
	IN 03
	CPI 7F
	CZ DBUNCE
	IN 03
	CPI 7F
	CZ SELECT
	   JMP MAIN
SELECT:	DI
	CALL XOR
	LDA 900A
	CPI 05
	CZ HITMISS
	LDA 900A
	CPI 05
	CNZ SAVE
	EI
	RET
SAVE:	MOV A,M
	ANA C
	RNZ
	MOV A,M
	ORA C
	MOV M,A
	LDA 900A
	INR A
	STA 900A
	CALL BIN2BCD
	LDA 900A
	CPI 05
	RNZ
	PUSH D
	LXI H,9010
	MVI D,90
	MVI E,30
	MVI B,08
LOOP3:	MOV A,M  ;FOR BLOCK SHIFTING
	STAX D
	INX H
	INX D
	DCR B
	JNZ LOOP3
	POP D
	MVI B,08
	LXI H,9010
LOOP4:	MVI A,00   ;CLEARIN RED REGISTER
	MOV M,A
	INX H
	DCR B
	JNZ LOOP4
	LXI H,9010
	RET
HITMISS:	MOV A,M
	ANA C
	RNZ
	MOV A,L
	ADI 10
	MOV L,A
	MOV A,M
	ANA C
	MOV B,A
	MOV A,L
	SUI 10
	MOV L,A
	MOV A,B
	CPI 00
	RNZ
	MOV A,L
	ADI 20
	MOV L,A
	MOV A,M
	ANA C
	MOV B,A
	MOV A,L
	SUI 20
	MOV L,A
	MOV A,B
	CPI 00
	CZ MISS
	MOV A,B
	CPI 00
	CNZ HIT
	RET
HIT:	MOV A,M
	ORA C
	MOV M,A
	LDA 9008
	INR A
	STA 9008
	LDA 9009
	INR A
	STA 9009
	CALL BIN2BCD
	LDA 9009
	CPI 05
	RNZ
	LDA 9009
	CPI 05
	JZ END
MISS:	MOV A,L
	ADI 10
	MOV L,A
	MOV A,M
	ORA C
	MOV M,A
	MOV A,L
	SUI 10
	MOV L,A
	LDA 9008 ; TOTAL HITS
	INR A
	STA 9008
	CALL BIN2BCD
	LDA 9008
	CPI 40
	RNZ
	HLT
LEFT:	CALL XOR
	MOV A,C
	RRC
	MOV C,A
	RET
RIGHT:	CALL XOR
	MOV A,C
	RLC
	MOV C,A
	RET
UP:	CALL XOR
	INX H
	MOV A,L
	CPI 18
	RNZ
	MVI L,10
	RET
DOWN:	CALL XOR
	DCX H
	MOV A,L
	CPI 0F
	RNZ
	MVI L,17
	RET
	
ISR:	   DI
	PUSH PSW
	PUSH H
	LHLD 9002
	MVI A,00
	OUT 01
	OUT 02
	MOV A,E
	   OUT 00
	   RRC
	   MOV E,A
	   MOV A,M
	   OUT 01
	MOV A,L
	ADI 10
	MOV L,A
	MOV A,M
	OUT 02
	MOV A,L
	SBI 10
	MOV L,A
	   INX H
	   MOV A,L
	   CPI 18
	   JNZ NEXT
	   MVI L,10
NEXT:              SHLD 9002
	POP H
	DCR D
	JNZ NOTREV
	MOV A,M
	XRA C
	MOV M,A
	LDA 9006
	CMA
	STA 9006
	MVI D,89
NOTREV:	   POP PSW 
	   EI
	   RET

DBUNCE:	 PUSH PSW
	MVI A,FF
	STA 9004
DLOOP:	MVI A,2B
	STA 9005
DLOOP2:	LDA 9005
	DCR A
	STA 9005
	JNZ DLOOP2
	LDA 9004
	DCR A
	STA 9004
	JNZ DLOOP
	POP PSW
	RET
XOR:	LDA 9006
	CPI FF
	RNZ
	MOV A,M
	XRA C
	MOV M,A
	MVI A,00
	STA 9006
	RET
BIN2BCD:	PUSH PSW
	PUSH D
	LDA 900A ; TOTAL NO OF SHIPS
	CPI 05
	LDA 900A
	JNZ SEVEN
	LDA 9008 ; TOTAL NO OF HITS
SEVEN:	MVI E,0A
	MVI D,FF
LOOPBIN:	INR D
	SUB E
	JNC LOOPBIN
	ADD E
	PUSH H
	LXI H,B010 ; LOCATION OF 7SEG CODES
	ADD L
	MOV L,A
	MOV A,M
	OUT 05
	MOV A,D
	LXI H,B010
	ADD L
	MOV L,A
	MOV A,M
	OUT 04
	POP H
	POP D
	POP PSW
	RET
END:	DI
	CALL BIN2BCD
	EI
	JMP END
